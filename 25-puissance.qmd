---
editor: 
  markdown: 
    wrap: sentence
---

<!-- # (PART) Analyse de puissance {-} -->

# Analyse de puissance avec R et G\*Power

```{r}
#| label: setup
#| echo: false
#| message: false
#| cache: false

source("code/book-fnc.R") 
```

Objectifs de ce chapitre :

-   Pouvoir calculer la **puissance** d‚Äôun test de t avec R et G\*Power
-   Pouvoir calculer l‚Äô**effectif requis** pour obtenir la puissance d√©sir√©e avec un test de t
-   Pouvoir calculer la **taille d‚Äôeffet d√©tectable** par un test de t √©tant donn√© *l‚Äôeffectif*, la *puissance* et $\alpha$
-   Comprendre comment la puissance change lorsque l‚Äôeffectif augmente, la taille d‚Äôeffet change, ou lorsque $\alpha$ diminue
-   Comprendre comment la puissance est affect√©e lorsque l‚Äôon passe d‚Äôun test bilat√©ral √† un test unilat√©ral

## La th√©orie

### Qu‚Äôest-ce que la puissance?

*La puissance est la probabilit√© de rejeter l‚Äôhypoth√®se nulle quand elle est fausse.*

### Pourquoi faire une analyse de puissance?

#### √âvaluer l‚Äô√©vidence {.unnumbered}

L‚Äôanalyse de puissance effectu√©e apr√®s avoir accept√© une hypoth√®se nulle permet de calculer la probabilit√© que l‚Äôhypoth√®se nulle soit rejet√©e si elle √©tait fausse et que la taille d‚Äôeffet √©tait d‚Äôune valeur donn√©e.
Ce type d‚Äôanalyse *a posteriori* est tr√®s commun.

#### Planifier de meilleures exp√©riences {.unnumbered}

L‚Äôanalyse de puissance effectu√©e avant de r√©aliser une exp√©rience (le plus souvent apr√®s une exp√©rience pr√©liminaire cependant), permet de d√©terminer le nombre d‚Äôobservations n√©cessaires pour d√©tecter un effet d‚Äôune taille donn√©e √† un niveau fixe de probabilit√© (la puissance).
Ce type d‚Äôanalyse a priori devrait √™tre r√©alis√© plus souvent.

#### Estimer la "limite de d√©tection" statistique {.unnumbered}

L‚Äôeffort d‚Äô√©chantillonnage est souvent d√©termin√© √† l‚Äôavance (par exemple lorsque vous h√©ritez de donn√©es r√©colt√©es par quelqu‚Äôun d‚Äôautre), ou tr√®s s√©v√®rement limit√© (lorsque les contraintes logistiques pr√©valent).
Que ce soit a priori ou a posteriori l‚Äôanalyse de puissance vous permet d‚Äôestimer, pour un effort d‚Äô√©chantillonnage donn√© et un niveau de puissance fixe, quelle est la taille minimale de l‚Äôeffet qui peut √™tre d√©tect√© (comme √©tant statistiquement significatif).

### Facteurs qui affectent la puissance

Il y a 3 facteurs qui affectent la puissance d‚Äôun test statistique.

#### Le crit√®re de d√©cision {.unnumbered}

La puissance d√©pend de $\alpha$, le seuil de probabilit√© auquel on rejette l‚Äôhypoth√®se nulle.
Si ce seuil est tr√®s strict (*i.e.* si $\alpha$ est fix√© √† une valeur tr√®s basse, comme 0.1% ou p = 0.001), alors la puissance sera plus faible que si le seuil √©tait moins strict.

#### La taille de l‚Äô√©chantillon {.unnumbered}

Plus l‚Äô√©chantillon est grand, plus la puissance est √©lev√©e.
La capacit√© d‚Äôun test √† d√©tecter de petites diff√©rences comme √©tant statistiquement significatives augmente avec une augmentation du nombre d‚Äôobservations.

#### La taille d‚Äôeffet {.unnumbered}

Plus la taille d‚Äôeffet est grande, plus un test a de puissance.
Pour un √©chantillon de taille fixe, la capacit√© d‚Äôun test √† d√©tecter un effet comme √©tant statistiquement significatif est plus √©lev√©e si l‚Äôeffet est grand que s‚Äôil est petit.
La taille d‚Äôeffet est en fait une mesure du degr√© de fausset√© de l‚Äôhypoth√®se nulle.

## Qu‚Äôest ce que G\*Power?

G\*Power est un programme gratuit, d√©velopp√© par des psychologues de l‚ÄôUniversit√© de Dusseldorf en Allemagne.
Le programme existe en version Mac et Windows.
Il peut cependant √™tre utilis√© sous linux via Wine ou une machine virtuelle.

G\*Power vous permettra d‚Äôeffectuer une analyse de puissance pour la majorit√© des tests que nous verrons au cours de la session sans avoir √† effectuer des calculs complexes ou farfouiller dans des tableaux ou des figures d√©crivant des distributions ou des courbes de puissance.
G\*power est vraiment un outil tr√®s utile que vous devrez ma√Ætriser.

Il est possible de faire toutes les analyses de G\*power avec R, mais cela est un peu plus complexes et n√©cessite un peu plus de code et donc une meilleure compr√©hension du processus.
Dans les cas les plus simple le code R est aussi fourni.

::: callout-caution
# Exercice

T√©l√©chargez le programme [**ici**](https://www.psychologie.hhu.de/arbeitsgruppen/allgemeine-psychologie-und-arbeitspsychologie/gpower.html) et installez-le sur votre ordi et votre station de travail au laboratoire (si ce n‚Äôest d√©j√† fait).
:::

## Comment utiliser G\*Power

### Principe g√©n√©ral

L‚Äôutilisation de G\*Power implique g√©n√©ralement 3 √©tapes:

1.  Choisir le test appropri√©
2.  Choisir l‚Äôun des 5 types d‚Äôanalyses de puissance disponibles
3.  Inscrire les valeurs des param√®tres requis et cliquer sur **Calculate**

### Types d‚Äôanalyses de puissance disponibles

#### A priori {.unnumbered}

**Calcule l‚Äôeffectif requis** pour une valeur de $\alpha$, $\beta$ et de taille d‚Äôeffet donn√©e.
Ce type d‚Äôanalyse est utile √† l‚Äô√©tape de planification des exp√©riences.

#### Compromis {.unnumbered}

**Calcule** $\boldsymbol{\alpha}$ **et** $\boldsymbol{\beta}$ pour un rapport $\beta / \alpha$ donn√©, un effectif fixe, et une taille d‚Äôeffet donn√©e.
Ce type d‚Äôanalyse est plus rarement utilis√© (je ne l‚Äôai jamais fait), mais peut √™tre utile lorsque le rapport $\beta / \alpha$ est d‚Äôint√©r√™t, par exemple lorsque le co√ªt d‚Äôune erreur de type I et de type II peut √™tre quantifi√©.

#### Crit√®re {.unnumbered}

**Calcule** $\boldsymbol{\alpha}$ pour $\beta$, effectif et taille d‚Äôeffet donn√©.
En pratique, je vois peu d‚Äôutilit√© pour ce type de calcul.
Contactez-moi si vous en voyez une!

#### Post-hoc {.unnumbered}

**Calcule la** **puissance (1 -** $\boldsymbol{\beta}$**)** pour $\alpha$, une taille d‚Äôeffet et un effectif donn√©.
Tr√®s utilis√©e pour interpr√©ter les r√©sultats d‚Äôune analyse statistique non-significative, mais seulement si l‚Äôon utilise une taille d‚Äôeffet biologiquement significative (et non la taille d‚Äôeffet observ√©e).
Peu pertinente lorsque le test est significatif.

#### Sensitivit√© {.unnumbered}

**Calcule la** **taille d‚Äôeffet d√©tectable** pour une valeur d‚Äô$\alpha$, $\beta$ et un effectif donn√©.
Tr√®s utile √©galement au stade de planification des exp√©riences.

### Comment calculer la taille d‚Äôeffet ?

***G\*Power permet de faire une analyse de puissance pour de nombreux tests statistiques.***

L‚Äôindice de la taille d‚Äôeffet qui est utilis√© par G\*Power pour les calculs d√©pend du test.
Notez que d‚Äôautres logiciels peuvent utiliser des indices diff√©rents et il est important de v√©rifier que l‚Äôindice que l‚Äôon utilise est celui qui convient.
G\*Power vous facilite la t√¢che et permet de calculer la taille d‚Äôeffet en inscrivant seulement les valeurs pertinentes dans la fen√™tre de calcul.
Le tableau suivant donne les indices utilis√©s par G\*Power pour les diff√©rents tests.

| Test | Taille d'effet | Formule |
|:---|:--:|:---|
| test de t sur des moyennes | d | $d = \frac{|\mu_1 - \mu_2|}{\sqrt{({s_1}^2 + {s_2}^2)/2}}$ |
| test de t pour des corr√©lations | r |  |
| autres tests de t | d | $d = \frac{\mu}{\sigma}$ |
| test F (ANOVA) | f | $f = \frac{\frac{\sqrt{\sum_{i=1}^k (\mu_i - \mu)^2}}{k}}{\sigma}$ |
| autres test F | $f^2$ | $f^2 = \frac{{R_p}^2}{1-{R_p}^2}$ |
|  |  | ${R_p}$ est le coefficient de corr√©lation partiel |
| test Chi-carr√© | w | $w = \sqrt{ \sum_{i=1}^m \frac{(p_{0i} - p_{1i})^2 }{ p_{0i}} }$ |
|  |  | $p_{0i}$ $p_{1i}$ sont les proportions de la cat√©gorie i pr√©dites par l'hypoth√®se nulle et alternative respectivement |

## Puissance pour un test de t comparant deux moyennes

::: callout-important
L'ensemble des analyses de puissance d√©crites apr√®s peuvent √™tre r√©alis√© avec 2 fonctions dans R.

-   `pwr.t.test()`: lorsque les tailles d'√©chantillons sont identiques
-   `pwr.t2n.test()`: lorsque les √©chantillons ont des tailles diff√©rentes
:::

L‚Äôobjectif de cette s√©ance de laboratoire est de vous familiariser avec G\*Power et de vous aider √† comprendre comment les quatre param√®tres des analyses de puissance ($\alpha$, $\beta$, effectif et taille d‚Äôeffet) sont reli√©s entre eux.
On examinera seulement l'un des nombreux tests : le *test de t* permettant de comparer deux moyennes ind√©pendantes.
C‚Äôest le test le plus commun√©ment utilis√© par les biologistes, vous l‚Äôavez tous d√©j√† utilis√©, et il conviendra tr√®s bien pour les besoins de la cause.
Ce que vous apprendrez aujourd‚Äôhui s‚Äôappliquera √† toutes les autres analyses de puissance que vous effectuerez √† l‚Äôavenir.

Jaynie Stephenson a √©tudi√© la productivit√© des ruisseaux de la r√©gion d‚ÄôOttawa.
Elle a, entre autres, quantifi√© la biomasse des poissons dans 18 ruisseaux sur le Bouclier Canadien d‚Äôune part, et dans 18 autres ruisseaux de la vall√©e de la rivi√®re des Outaouais et de la rivi√®re Rideau d‚Äôautre part.
Elle a observ√© une biomasse plus faible dans les ruisseaux de la vall√©e (2.64 $g/m^2$, √©cart-type=3.28) que dans ceux du Bouclier (3.31 $g/m^2$, √©cart-type=2.79).
En faisant un test de t pour √©prouver l‚Äôhypoth√®se nulle que la biomasse des poissons est la m√™me dans les deux r√©gions, elle obtient:

```         
Pooled-Variance Two-Sample t-Test
t = -0.5746, df = 34, p-value = 0.5693
```

Elle accepte l‚Äôhypoth√®se nulle (puisque p est plus √©lev√© que 0.05) conclue donc que la biomasse moyenne des poissons est la m√™me dans ces deux r√©gions.

### Analyse post-hoc - Calculer la puissance du test

Compte tenu des valeurs des moyennes observ√©es et de leur √©cart- type, on peut utiliser G\*Power pour calculer la puissance du test de t bilat√©ral pour deux moyennes ind√©pendantes et pour la taille d‚Äôeffet (i.e. la diff√©rence entre la biomasse entre les deux r√©gions, pond√©r√©e par les √©carts-type) √† $\alpha$ = 0.05.

D√©marrer G\*Power.

1.  √Ä **Test family**, choisir: t tests
2.  √Ä **Statistical test**, choisir: Means: Difference between two independent means (two groups)
3.  √Ä **Type of power analysis**, choisir: Post hoc: Compute achieved power - given $\alpha$, sample size, and effect size
4.  Dans **Input Parameters**,

-   √† la bo√Æte **Tail(s)**, choisir: Two,
-   v√©rifier que $\boldsymbol{\alpha}$ **err prob** est √©gal √† 0.05
-   inscrire 18 pour **Sample size group** 1 et 2
-   pour calculer la taille d‚Äôeffet (Effect size d), cliquer sur le bouton **Determine =\>**

5.  Dans la fen√™tre qui s‚Äôouvre √† droite, s√©lectionner $\boldsymbol{n1 = n2}$

-   entrer les moyennes (**Mean group** 1 et 2)
-   entrer les √©carts types (**SD** $\boldsymbol{\sigma}$ **group** 1 et 2)
-   cliquer sur le bouton **Calculate and transfer to main window**

6.  Cliquer sur le bouton **Calculate** dans la fen√™tre principale et vous devriez obtenir ceci:

```{r}
#| label: fig-gpower-1
#| echo: false
#| fig-cap: Analyse post-hoc avec la taille d'effet estim√©e
#| out-width: 100%
knitr::include_graphics("images/gpower_1.png")
```

La m√™me analyse peut √™tre faites en utlisant R.
D'abord, il faut calculer la taille d'effet `d` pour un test de t comparant deux moyennes, puis utiliser la fonction `pwr.t.test` du paquet `pwr` üì¶.
Le plus simple comme nous allons estimer la taille d'effet `d` plusieurs fois et de cr√©er une petite fonction qui estime `d` bas√© sur les param√®tres n√©cessaires.

```{r}
#| label: fig-r-power
#| fig-cap: Graphique de l'analyse de puissance dans R
# charger le paquet pwr
library(pwr)
# d√©finir une fonction pour d
d <- function(u1, u2, sd1, sd2) {
  abs(u1 - u2) / sqrt((sd1^2 + sd2^2) / 2)
}

# analyse de puissance

d_cohen <- d(u1 = 2.64, sd1 = 3.28, u2 = 3.31, sd2 = 2.79)

pwr.t.test(
  n = 18, d = d_cohen, sig.level = 0.05,
  type = "two.sample"
)

# graphique comme g*Power
x <- seq(-4, 4, length = 200)
y0 <- dt(x, 34)
y1 <- dt(x, 34, ncp = d_cohen * sqrt(36) / 2)
plot(x, y0, type = "l", col = "red", lwd = 2)
qc <- qt(0.025, 34)
abline(v = qc, col = "green")
abline(v = -qc, col = "green")
lines(x, y1, type = "l", col = "blue", lwd = 2)

# l'erreur de type 2 correspond √† la zone bleue
polygon(
  c(x[x <= -qc], -qc), c(y1[x <= -qc], 0),
  col = rgb(red = 0, green = 0.2, blue = 1, alpha = 0.5)
)
```

```{r}
#| label: fig-ggplot
#| eval: false

qc <- qt(0.025, 34)
ncp <- d_cohen * sqrt(36) / 2
dat <- data.frame(
  x = seq(-4, 4, length = 200),
  y0 = dt(x, (n - 1) * 2),
  y1 = dt(x, (n - 1) * 2, ncp = ncp)
) %>%
  mutate(
    area = ifelse(x <= qc, y1, 0)
  )

ggplot(dat, aes(x = x)) +
  geom_line(aes(y = y0), color = "red") +
  geom_line(aes(y = y1), color = "blue") +
  geom_vline(xintercept = qcl, color = "green") +
  geom_area(
    aes(x = x, y = area),
    fill = rgb(red = 0, green = 0.2, blue = 1, alpha = 0.5)
  ) +
  theme_classic() +
  ylab("dt(x)")
```

√âtudions un peu la figure @fig-gpower-1.

-   La courbe de gauche, en rouge, correspond √† la **distribution de la statistique t si** $\boldsymbol{H_0}$ **est vraie** (i.e si les deux moyennes √©taient √©gales) compte tenu de l‚Äôeffectif (18 dans chaque r√©gion) et des √©carts- types observ√©s.
-   Les lignes verticales vertes correspondent aux **valeurs critiques de t pour** $\boldsymbol{\alpha = 0.05}$ et un effectif total de 36 (2x18).
-   Les r√©gions ombr√©es en rose correspondent aux **zones de rejet de** $\boldsymbol{H_0}$ (${\alpha/2}$) <!--# JULIEN - j'ai rajout√© le alpha/2 parceque je trouve que √ßa aide √† comprendre mais enl√®ve le si tu pense que ce n'est pas pertinent ou sujet √† quiproquo -->. Si Jaynie avait obtenu une valeur de t en dehors de l‚Äôintervalle d√©limit√© par les valeurs critiques allant de -2.03224 √† 2.03224, alors elle aurait rejet√© $H_0$, l‚Äôhypoth√®se nulle d‚Äô√©galit√© des deux moyennes. En fait, elle a obtenu une valeur de t √©gale √† -0.5746 et conclu que la biomasse est la m√™me dans les deux r√©gions.
-   La courbe de droite, en bleu, correspond √† la **distribution de la statistique t si** $\boldsymbol{H_1}$ **est vraie** (ici $H_1$ correspond √† une diff√©rence de biomasse entre les deux r√©gions de $3.33-2.64=0.69g/m^2$, compte tenu des √©carts-types observ√©s). Cette distribution correspond √† ce qu‚Äôon devrait s‚Äôattendre √† observer si $H_1$ √©tait vraie et que l‚Äôon r√©p√©tait un grand nombre de fois les mesures dans des √©chantillons al√©atoires de 18 ruisseaux des deux r√©gions en calculant la statistique t √† chaque fois. En moyenne, on observerait une valeur de t d‚Äôenviron 0.6.
-   Notez que la distribution de droite chevauche consid√©rablement celle de gauche, et une bonne partie de la surface sous la courbe de droite se retrouve √† l‚Äôint√©rieur de l‚Äôintervalle d‚Äôacceptation de $H_0$, d√©limit√© par les deux lignes vertes et allant de -2.03224 √† 2.03224. Cette proportion, correspondant √† la partie ombr√©e en bleu sous la courbe de droite et d√©not√© par $\beta$ correspond au risque d‚Äôerreur de type II qui est d‚Äôaccepter $H_0$ quand $H_1$ est vraie.
-   La **puissance est simplement** $\boldsymbol{1-\beta}$, et est ici de 0.098339 (*R√©sultats du test d'estimation de puissance*) <!--# JULIEN - pareil, dis moi si ce n'√©tait pas utile de le mentioner -->. Donc, si la biomasse diff√©rait de 0.69$g/m^2$ entre les deux r√©gions, Jaynie n‚Äôavait que 9.8% des chances d‚Äô√™tre capable de d√©tecter une diff√©rence statistiquement significative √† $\alpha=5%$ en √©chantillonnant 18 ruisseaux de chaque r√©gion.

**R√©capitulons:** La diff√©rence de biomasse entre les deux r√©gions n‚Äôest pas statistiquement significative d‚Äôapr√®s le test de t.
C‚Äôest donc que cette diff√©rence est relativement petite compte tenu de la pr√©cision des mesures.
Il n‚Äôest donc pas tr√®s surprenant que la puissance, i.e. *la probabilit√© de d√©tecter une diff√©rence significative*, soit faible.
Toute cette analyse ne nous informe pas beaucoup.

**Une analyse de puissance post hoc avec la taille d‚Äôeffet observ√© n‚Äôest pas tr√®s utile.** On la fera plut√¥t pour une taille d‚Äôeffet autre que celle observ√©e quand $H_0$ est accept√©e.
*Quelle taille d‚Äôeffet utiliser?* C‚Äôest la biologie du syst√®me √©tudi√© qui peut nous guider.
Par exemple, en ce qui concerne la biomasse des poissons, on pourrait s‚Äôattendre √† ce qu‚Äôune diff√©rence de biomasse du simple au double (disons de 2.64 √† 5.28 $g/m^2$) ait des cons√©quences √©cologiques.
On voudrait s‚Äôassurer que Jaynie avait de bonnes chances de d√©tecter une diff√©rence aussi grande que celle-l√† avant d‚Äôaccepter ses conclusions que la biomasse est la m√™me entre les deux r√©gions.
Quelles √©taient les chances de Jaynie de d√©tecter une diff√©rence de 2.64 $g/m^2$ entre les deux r√©gions?
G\*Power peut nous le dire.

::: callout-caution
# Exercice

Changer la moyenne du groupe 2 √† 5.28, recalculer la taille d‚Äôeffet, et cliquer sur **Calculate** pour obtenir @fig-gpower-2.
:::

```{r}
#| label: fig-gpower-2
#| echo: false
#| fig-cap: Analyse post-hoc avec une taille d'effet diff√©rente
#| out-width: 100%
knitr::include_graphics("images/gpower_2.png")
```

```{r}
pwr.t.test(
  n = 18, d = d(u1 = 2.64, sd1 = 3.28, u2 = 5.28, sd2 = 2.79),
  sig.level = 0.05, type = "two.sample"
)
```

```{r}
#| label: fig-pwr1
#| echo: false
plot_pwr(
  n = 18,
  d = d(u1 = 2.64, sd1 = 3.28, u2 = 5.28, sd2 = 2.79),
  sig_level = 0.05, alternative = "two.sided"
)
```

La puissance est de 0.71, donc Jaynie avait une chance raisonnable (71%) de d√©tecter une diff√©rence du simple au double avec 18 ruisseaux dans chaque r√©gion.

Notez que cette analyse de puissance post hoc pour une taille d‚Äôeffet jug√©e biologiquement significative est bien plus informative que l‚Äôanalyse pr√©c√©dente pour la taille d‚Äôeffet observ√©e (qui est celle effectu√©e par d√©faut par bien des n√©ophytes et de trop nombreux logiciels qui essaient de penser pour nous).
En effet, Jaynie n‚Äôa pu d√©tecter de diff√©rences significatives entre les deux r√©gions.
Cela pourrait √™tre pour deux raisons: soit qu‚Äôil n‚Äôy a pas de diff√©rences entre les r√©gions, ou alors parce que la pr√©cision des mesures est si faible et l‚Äôeffort d‚Äô√©chantillonnage si limit√© qu‚Äôil √©tait tr√®s peu probable de d√©tecter m√™me d‚Äô√©normes diff√©rences.
La deuxi√®me analyse de puissance permet d‚Äô√©liminer cette seconde possibilit√© puisque Jaynie avait 71% des chances de d√©tecter une diff√©rence du simple au double.

### Analyse √† priori - Calculer la taille de l‚Äôeffectif √† √©chantillonner

Supposons qu‚Äôon puisse d√©fendre la position qu‚Äôune diff√©rence de biomasse observ√©e par Jaynie entre les deux r√©gions, $3.31- 2.64=0.67g/m^2$, soit √©cologiquement significative.
On devrait donc planifier la prochaine saison d‚Äô√©chantillonnage de mani√®re √† avoir de bonnes chances de d√©tecter une diff√©rence de cette taille.
Combien de ruisseaux Jaynie devrait-elle √©chantillonner pour avoir 80% des chances de la d√©tecter (compte tenu de la variabilit√© observ√©e)?

::: callout-caution
# Exercice

Changer le type d‚Äôanalyse de puissance dans G\*Power √† **A priori**: **Compute sample size - given** $\alpha$**, power, and effect size**.
Assurez-vous que les valeurs pour les moyennes et les √©carts-type soient celles qu‚Äôa obtenu Jaynie, recalculez la taille de l‚Äôeffet, et inscrivez 0.8 pour la puissance @fig-gpower-3.
:::

```{r}
#| label: fig-gpower-3
#| echo: false
#| fig-cap: Analyse √† priori
#| out-width: 100%
knitr::include_graphics("images/gpower_3.png")
```

```{r}
pwr.t.test(
  power = 0.8, d = d(u1 = 2.64, sd1 = 3.28, u2 = 3.31, sd2 = 2.79),
  sig.level = 0.05, type = "two.sample"
)
```

**Ouch!** Il faudrait √©chantillonner 326 ruisseaux dans chaque r√©gion!
Cela co√ªterait une fortune et exigerait de nombreuses √©quipes de travail.
Sans cela, on ne pourrait √©chantillonner que quelques dizaines de ruisseaux, et il serait peu probable que l‚Äôon puisse d√©tecter une si faible diff√©rence de biomasse entre les deux r√©gions.
Ce serait vraisemblablement en vain et pourrait √™tre consid√©r√© comme une perte de temps: pourquoi tant d‚Äôefforts et de d√©penses si les chances de succ√®s sont si faibles.

Si on refait le m√™me calcul pour une puissance de 95%, on obtient 538 ruisseaux par r√©gion.
Augmenter la puissance √ßa demande plus d‚Äôeffort.

```{r}
pwr.t.test(
  power = 0.95, d = d(u1 = 2.64, sd1 = 3.28, u2 = 3.31, sd2 = 2.79),
  sig.level = 0.05, type = "two.sample"
)
```

### Analyse de sensitivit√© - Calculer la taille d‚Äôeffet d√©tectable

Compte tenu de la variabilit√© observ√©e, d‚Äôun effort d‚Äô√©chantillonnage de 18 ruisseaux par r√©gion, et en conservant $\alpha=0.05$, quelle est la taille d‚Äôeffet que Jaynie pouvait d√©tecter avec 80% de chances ($\beta=0.2$) ?

::: callout-caution
# Exercice

Changez le type d‚Äôanalyse dans G\*Power √† **Sensitivity**: **Compute required effect size - given** $\alpha$**, power, and sample size** et assurez-vous que la taille des √©chantillons est de 18 dans chaque r√©gion.
:::

```{r}
#| label: fig-gpower-4
#| echo: false
#| fig-cap: Analyse de sensitivit√©
#| out-width: 100%
knitr::include_graphics("images/gpower_4.png")
```

```{r}
pwr.t.test(power = 0.8, n = 18,
           sig.level = 0.05, type = "two.sample")
```

La taille d‚Äôeffet d√©tectable pour cette taille d‚Äô√©chantillon, $\alpha=0.05$ et $\beta=0.2$ (ou une puissance de 80%) est de 0.961296.

::: callout-warning
cette valeur est l‚Äôindice `d` de la taille d‚Äôeffet et est pond√©r√©e par la variabilit√© des mesures.
:::

Dans ce cas ci, `d` est approximativement √©gal √† $$ d = \frac{| \bar{X_1} \bar{X_2} |} {\sqrt{\frac{{s_1}^2 +{s_2}^2}{2}}}$$ Pour convertir cette valeur de d sans unit√©s en une valeur de diff√©rence de biomasse d√©tectable (i.e $| \bar{X_1} \bar{X_2} |$), il suffit de multiplier `d` par le d√©nominateur de l‚Äô√©quation.
$$
| \bar{X_1} \bar{X_2} | = d * \sqrt{\frac{{s_1}^2 +{s_2}^2}{2}}
$$ Dans R, on peut estimer cela avec:

```{r}
pwr.t.test(
  power = 0.8, n = 18, sig.level = 0.05,
  type = "two.sample")$d * sqrt((3.28^2 + 2.79^2) / 2)
```

Donc, avec 18 ruisseaux dans chaque r√©gion, pour $\alpha=0.05$ et $\beta=0.2$ (une puissance de 80%), Jaynie pouvait d√©tecter une diff√©rence de biomasse de 2.93$g/m^2$ entre les r√©gions, un peu plus que du simple au double.

## Points √† retenir

-   L‚Äôanalyse de puissance post hoc n‚Äôest pertinente que lorsque l‚Äôon a accept√© l‚Äôhypoth√®se nulle. Il est en effet impossible de faire une erreur de type II quand on rejette $H_0$.
-   Avec de tr√®s grands √©chantillons, on a une puissance quasi infinie et on peut d√©tecter statistiquement de tr√®s petites diff√©rences qui ne sont pas n√©cessairement biologiquement significatives.
-   En utilisant un crit√®re de signification plus strict ($\alpha < 0.05$) on diminue notre puissance.
-   En voulant maximiser la puissance, on augmente l‚Äôeffort requis, √† moins d‚Äôutiliser une valeur critique plus lib√©rale ($\alpha>0.05$)
-   Le choix de $\beta$ est quelque peu arbitraire. On consid√®re que $\beta=0.2$ (puissance de 80%) est relativement √©lev√©.
